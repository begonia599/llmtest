# LLM 网关基准测试结果

## 服务器配置
- **服务器 A（压测端）**: 8C/16G — mock-llm + k6
- **服务器 B（网关端）**: 4C/8G — 被测网关

---

## 第一轮：50 虚拟用户（VU）/ 20 凭证 / 60 秒

### 性能指标（k6 采集）

| 指标 | Go | Node.js | Next.js |
|------|---:|--------:|--------:|
| 每秒请求数 (RPS) | 6.69 | 6.72 | 6.82 |
| 总请求数 | 511 | 494 | 516 |
| 平均延迟 (ms) | 6300.64 | 6569.07 | 6281.57 |
| P50 延迟 (ms) | 6432.08 | 6961.11 | 6803.99 |
| P95 延迟 (ms) | 14669.36 | 14977.09 | 14714.86 |
| 成功率 (%) | 100.00 | 100.00 | 100.00 |
| SSE 数据块总数 | 46479 | 47155 | 46895 |

### 资源消耗（服务器 B — 网关进程）

| 指标 | Go | Node.js | Next.js |
|------|---:|--------:|--------:|
| 空闲 CPU (%) | 3.8-4.0 | 0.1 | 0.3-0.4 |
| 峰值 CPU (%) | 5.6 | 5.5 | 8.8 |
| 空闲内存 (MB) | 48 | 57.92 | 85.01 |
| 峰值内存 (MB) | 107 | 118.81 | 158.98 |
| 垃圾回收后内存 (MB) | 47 | 79.75 | 107.58 |
| 峰值文件描述符 | 110 | 123 | 123 |
| 线程数 | 7 | 11 | 11 |

---

## 第二轮：1000 虚拟用户（VU）/ 500 凭证 / 120 秒

### 性能指标（k6 采集，3 轮均值）

| 指标 | Go | Node.js | Next.js |
|------|---:|--------:|--------:|
| 每秒请求数 (RPS) | **119.85** | 112.13 | 79.49 |
| RPS 范围 | 104.07 - 138.56 | 104.60 - 116.43 | 79.05 - 80.11 |
| 总请求数（均值） | **16832** | 15777 | 11053 |
| 平均延迟 (ms) | **7573.70** | 8039.21 | 11256.45 |
| P50 延迟 (ms) | **7531.81** | 7907.74 | 8538.81 |
| P95 延迟 (ms) | 18530.09 | **18069.27** | 21375.02 |
| 成功率 (%) | **100.00** | **100.00** | 98.36 |
| SSE 数据块总数（均值） | **1585252** | 1490445 | 1029528 |

### 资源消耗与效率（服务器 B — 4C/8G 网关进程）

| 指标 | Go | Node.js | Next.js |
|------|---:|--------:|--------:|
| 峰值 CPU - 服务器总量 (%) | 26.75 | 22.78 | 25.00 |
| 峰值 CPU - 单核占用 (%) | 107 | 91.1 | 100 |
| 峰值内存 (MB) | 1795.85 | 386.75 | 746.68 |
| 峰值文件描述符 | 2016 | 2149 | 1091 |
| 线程数 | 9 | 11 | 11 |
| **每 1% 服务器 CPU 产出 RPS** | 4.48 | **4.92** | 3.18 |
| **每 MB 内存产出 RPS** | 0.067 | **0.290** | 0.106 |

> 服务器 CPU = 单核占用 / 4 核，即 400% 满载对应 100% 服务器利用率
> 效率指标按「3 轮均值 RPS / 峰值资源」计算

### 第二轮分析

**吞吐与稳定性**：
- Go 吞吐最高，RPS 均值 **119.85**，比 Node.js 高约 **6.9%**，比 Next.js 高约 **50.8%**
- Go 与 Node.js 均达到 **100% 成功率**，Next.js 为 **98.36%**

**延迟特征**：
- Go 的平均延迟与 P50 最低（7573.70 / 7531.81 ms）
- Node.js 的 P95 更低（18069.27 ms），说明尾延迟在本轮略优于 Go
- Next.js 在吞吐和延迟上都明显落后

**资源效率**：
- Go 峰值 CPU 更高（26.75%），换来最高吞吐
- Node.js 在单位资源效率上更优：每 1% CPU 产出 **4.92 RPS**、每 MB 内存产出 **0.290 RPS**
- Next.js 存在框架层开销，效率处于三者末位

**核心结论**：
- 在 `1000 虚拟用户 / 500 凭证 / 120 秒` 场景下，**Go 是绝对吞吐最优解**
- **Node.js 是资源效率最优解**（单位 CPU 与单位内存产出更高）
- **Next.js 不适合该强压流式场景**（吞吐低且存在失败）

---

## 第三轮：5000 虚拟用户（VU）/ 1000 凭证 / 120 秒（50% 流式 + 50% 非流式）

> 数据目录：
> `go/go-5000vus-20260212-115357`
> `node/node-5000vus-20260212-115357`
> `next/next-5000vus-20260212-115357`

### 性能指标（k6 单轮）

| 指标 | Go | Node.js | Next.js |
|------|---:|--------:|--------:|
| 每秒请求数 (RPS) | **75.96** | 51.00 | 66.95 |
| 总请求数 | 11399 | 7729 | **14998** |
| 平均延迟 (ms) | 45064.21 | 59757.96 | **38955.61** |
| P50 延迟 (ms) | 27643.94 | 47779.09 | **10250.05** |
| P95 延迟 (ms) | 120000.69 | 120000.55 | 119855.99 |
| 成功率 (%) | **85.16** | 73.06 | 78.91 |
| SSE 数据块总数 | 394695 | 118992 | **637170** |
| 被中断迭代数 | 3226 | **4700** | 2541 |

### 资源峰值（服务器 B — 4C/8G 网关进程）

| 指标 | Go | Node.js | Next.js |
|------|---:|--------:|--------:|
| 峰值 CPU - 服务器总量 (%) | 20.45 | 13.70 | **22.95** |
| 峰值 CPU - 单核占用 (%) | 81.8 | 54.8 | **91.8** |
| 峰值内存 (MB) | **6104.94** | 473.02 | 746.70 |
| 峰值文件描述符 | 11032 | **11070** | 4070 |
| 线程数 | **44** | 11 | 11 |
| 每 1% 服务器 CPU 产出 RPS | 3.71 | **3.72** | 2.92 |
| 每 MB 内存产出 RPS | 0.012 | **0.108** | 0.090 |

### 第三轮分析

**这是一轮“容量边界/失稳”测试，不是常规性能对比轮**：
- 三个网关都出现大量超时告警（`请求超时`），且成功率显著下降（73.06% - 85.16%）
- 三者 P95 都接近 `120 秒`，说明尾延迟已触顶到请求超时上限
- `被中断迭代` 数量高，证明并发压力超过当前稳定处理区间

**对比观察**：
- Go 吞吐与成功率在本轮最高，但内存峰值达到 **6.1GB**，线程数升至 **44**
- Next.js 在延迟中位数（P50）和总请求数上表现更好，但成功率仍明显低于 90%
- Node.js 资源占用最低、单位资源产出仍高，但吞吐和成功率在本轮垫底

**结论**：
- 在 `5000 虚拟用户 / 1000 凭证 / 120 秒` 下，当前三套实现均进入失稳区
- 本轮结果应作为**容量上限告警样本**记录，而非用于“稳定性能”横向排名

---

## 第四轮：公平容量测试（已独立）

第四轮完整报告已拆分到独立文档：`BENCHMARK-ROUND4.md`

---

## 第五轮：公平容量测试（2 核限制，已独立）

第五轮完整报告已拆分到独立文档：`BENCHMARK-ROUND5.md`

---

## 第六轮：稳定区验证（300-1300 虚拟用户，已独立）

第六轮完整报告已拆分到独立文档：`BENCHMARK-ROUND6.md`

---

## 第七轮：2 核限制混合流量（300-1300 虚拟用户，已独立）

第七轮完整报告已拆分到独立文档：`BENCHMARK-ROUND7.md`

---

## 第八轮：2 核限制全流式（300-1300 虚拟用户，已独立）

第八轮完整报告已拆分到独立文档：`BENCHMARK-ROUND8.md`

---

## 第九轮：2 核限制全非流式（300-1300 虚拟用户，已独立）

第九轮完整报告已拆分到独立文档：`BENCHMARK-ROUND9.md`

---

## 第十轮：2 核限制混合流量（1000-5000 虚拟用户，已独立）

第十轮完整报告已拆分到独立文档：`BENCHMARK-ROUND10.md`
